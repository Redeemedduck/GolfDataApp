---
phase: 02-analytics-engine
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - "pages/2_\U0001F4CA_Dashboard.py"
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User sees dispersion chart, distance table, miss tendency, progress tracker, and session quality score on the Dashboard page"
    - "User can filter dispersion and miss tendency views by club using a dropdown"
    - "Session quality score displays composite 0-100 score derived from stored session metrics"
  artifacts:
    - path: "pages/2_\U0001F4CA_Dashboard.py"
      provides: "Dashboard with all 5 analytics components integrated"
      contains: "render_dispersion_chart|render_distance_table|render_miss_tendency|render_progress_tracker|render_session_quality"
  key_links:
    - from: "pages/2_\U0001F4CA_Dashboard.py"
      to: "components/__init__.py"
      via: "from components import render_dispersion_chart, render_distance_table, render_miss_tendency, render_progress_tracker, render_session_quality"
      pattern: "from components import.*render_dispersion_chart"
    - from: "pages/2_\U0001F4CA_Dashboard.py"
      to: "golf_db.get_session_metrics"
      via: "golf_db.get_session_metrics(selected_session_id)"
      pattern: "golf_db\\.get_session_metrics"
---

<objective>
Integrate all 5 analytics components into the Dashboard page so users can actually see them.

Purpose: Phase 2 built 5 analytics components (dispersion chart, distance table, miss tendency, progress tracker, session quality) but never wired them into the Dashboard UI. Users cannot access any analytics. This gap closure connects the components to the existing tab structure.

Output: Updated `pages/2_ğŸ“Š_Dashboard.py` with all 5 analytics components rendered, a club selector for filtered views, and session quality wired to stored metrics.
</objective>

<execution_context>
@/Users/max1/.claude/get-shit-done/workflows/execute-plan.md
@/Users/max1/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@pages/2_ğŸ“Š_Dashboard.py
@components/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Import analytics components and add club selector</name>
  <files>pages/2_ğŸ“Š_Dashboard.py</files>
  <action>
    In `pages/2_ğŸ“Š_Dashboard.py`:

    1. **Add imports** â€” In the existing `from components import (...)` block, add the 5 new analytics components:
       - `render_dispersion_chart`
       - `render_distance_table`
       - `render_miss_tendency`
       - `render_progress_tracker`
       - `render_session_quality`

    2. **Add a 6th tab** â€” Change the tab creation from 5 tabs to 6:
       ```python
       tab1, tab2, tab3, tab4, tab5, tab6 = st.tabs([
           "ğŸ“ˆ Performance Overview",
           "ğŸ¯ Impact Analysis",
           "ğŸ“Š Trends Over Time",
           "ğŸŒï¸ Shot Analytics",
           "ğŸ” Shot Viewer",
           "ğŸ’¾ Export Data"
       ])
       ```
       The new "Shot Analytics" tab (tab4) slots in before Shot Viewer. Existing tab4 (Shot Viewer) becomes tab5. Existing tab5 (Export Data) becomes tab6. Update all `with tabN:` blocks accordingly.

    3. **Build the Shot Analytics tab (new tab4)** â€” Inside `with tab4:`:

       a. **Club selector dropdown** at the top:
       ```python
       st.header("Shot Analytics")
       clubs_in_data = sorted(df['club'].unique().tolist())
       club_options = ["All Clubs"] + clubs_in_data
       selected_analytics_club = st.selectbox(
           "Filter by Club",
           club_options,
           key="analytics_club_filter"
       )
       analytics_club = None if selected_analytics_club == "All Clubs" else selected_analytics_club
       ```

       b. **Dispersion Chart** â€” Two-column layout:
       ```python
       col_disp, col_dist = st.columns(2)
       with col_disp:
           render_dispersion_chart(df, selected_club=analytics_club)
       with col_dist:
           render_distance_table(df)
       ```

       c. **Miss Tendency** â€” Full width:
       ```python
       st.divider()
       render_miss_tendency(df, selected_club=analytics_club)
       ```

       d. **Session Quality** â€” Wire to `golf_db.get_session_metrics()`:
       ```python
       st.divider()
       session_metrics = golf_db.get_session_metrics(selected_session_id)
       if session_metrics:
           render_session_quality(session_metrics)
       else:
           st.info("Session quality score not available. Session metrics may not be computed yet.")
       ```

    4. **Add progress tracker to the Trends tab (tab3)** â€” At the END of the existing `with tab3:` block (after the per-club trends section), add:
       ```python
       st.divider()
       st.subheader("Statistical Progress Analysis")
       all_shots_for_progress = get_session_data_cached(read_mode=read_mode)
       if not all_shots_for_progress.empty:
           progress_metric = st.selectbox(
               "Track Metric",
               ['carry', 'total', 'ball_speed', 'smash'],
               format_func=lambda x: {'carry': 'Carry Distance', 'total': 'Total Distance', 'ball_speed': 'Ball Speed', 'smash': 'Smash Factor'}[x],
               key="progress_metric"
           )
           render_progress_tracker(all_shots_for_progress, metric=progress_metric)
       ```
       This adds the new statistically-significant progress tracker alongside the existing basic trend chart. The progress tracker provides RÂ², p-value, and significance testing that the existing trend chart does not.

    **Important:** Do NOT remove any existing content from tabs 1-5 (now tabs 1-3, 5-6). Only add new content. The existing dispersion plot in tab1 (Performance Overview) stays â€” it's a simpler overview; the new analytics tab provides the detailed per-club version with IQR filtering.
  </action>
  <verify>
    Run: `python -m py_compile pages/2_ğŸ“Š_Dashboard.py`
    Must exit 0 (no syntax errors).

    Run: `python -c "from pages import *; print('Dashboard imports OK')"` â€” if this fails due to Streamlit not being importable in test context, that's OK. The py_compile check is sufficient.

    Grep check: `grep -c 'render_dispersion_chart\|render_distance_table\|render_miss_tendency\|render_progress_tracker\|render_session_quality' pages/2_ğŸ“Š_Dashboard.py` â€” should return at least 5 matches (imports) + 5 matches (render calls) = 10+.
  </verify>
  <done>
    Dashboard page imports all 5 analytics components. New "Shot Analytics" tab contains dispersion chart, distance table, miss tendency, and session quality â€” all rendered with real function calls. Club selector dropdown filters dispersion and miss tendency by club. Progress tracker added to Trends tab with significance testing. Existing tabs remain unchanged.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify integration with existing tests and py_compile</name>
  <files>pages/2_ğŸ“Š_Dashboard.py</files>
  <action>
    1. Run `python -m py_compile pages/2_ğŸ“Š_Dashboard.py` to verify no syntax errors.
    2. Run `python -m unittest discover -s tests` to verify no regressions in existing test suite.
    3. Run `python -c "from components import render_dispersion_chart, render_distance_table, render_miss_tendency, render_progress_tracker, render_session_quality; print('All analytics components importable')"` to verify the imports resolve.

    If any test fails that is NOT related to the Dashboard integration (e.g., pre-existing failures), note them but do not fix â€” they are out of scope for this gap closure.

    If py_compile fails, fix the syntax error in `pages/2_ğŸ“Š_Dashboard.py` immediately.
  </action>
  <verify>
    `python -m py_compile pages/2_ğŸ“Š_Dashboard.py` exits 0.
    `python -m unittest discover -s tests` reports no NEW failures (compare to baseline of 207 passing, 80 skipped from STATE.md).
    All 5 component imports resolve without ImportError.
  </verify>
  <done>
    Dashboard page compiles cleanly. All existing tests still pass. All 5 analytics components are importable. Gap closed: users can now access analytics from the Dashboard.
  </done>
</task>

</tasks>

<verification>
1. `python -m py_compile pages/2_ğŸ“Š_Dashboard.py` â€” exits 0
2. `grep -c 'render_dispersion_chart' pages/2_ğŸ“Š_Dashboard.py` â€” at least 2 (import + call)
3. `grep -c 'render_distance_table' pages/2_ğŸ“Š_Dashboard.py` â€” at least 2
4. `grep -c 'render_miss_tendency' pages/2_ğŸ“Š_Dashboard.py` â€” at least 2
5. `grep -c 'render_progress_tracker' pages/2_ğŸ“Š_Dashboard.py` â€” at least 2
6. `grep -c 'render_session_quality' pages/2_ğŸ“Š_Dashboard.py` â€” at least 2
7. `grep -c 'get_session_metrics' pages/2_ğŸ“Š_Dashboard.py` â€” at least 1
8. `grep -c 'analytics_club_filter' pages/2_ğŸ“Š_Dashboard.py` â€” at least 1 (club selector)
9. `python -m unittest discover -s tests` â€” no new failures
</verification>

<success_criteria>
- All 5 analytics components (dispersion, distance, miss tendency, progress, session quality) are rendered in the Dashboard
- Club selector dropdown filters dispersion chart and miss tendency by selected club
- Session quality score is wired to golf_db.get_session_metrics() for real data
- Progress tracker is available in the Trends tab with statistical significance
- No existing Dashboard functionality is removed or broken
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-analytics-engine/02-04-SUMMARY.md`
</output>
