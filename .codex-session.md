# Codex Orchestrator Session: Phases 5-7 (Club Profiles, Big 3 & UX, Advanced)

**Date:** 2026-02-13
**Project:** GolfDataApp
**Base SHA:** cc373cd262214f0d9023d91f93884ed5dbd60c83
**Branch:** main (will create feature branches per phase)

## Task Queue

### Phase 5: Club Profiles Rebuild

| # | Task | Status | SHA Before | SHA After |
|---|------|--------|------------|-----------|
| 1 | 5a. Filter club dropdown to bag clubs only | pending | | |
| 2 | 5b. Smart comparison suggestions | pending | | |
| 3 | 5c. Fix Distance Over Time x-axis labels | pending | | |
| 4 | 5-tests. Add unit tests for Phase 5 changes | pending | | |

### Phase 6: Big 3 & UX Polish

| # | Task | Status | SHA Before | SHA After |
|---|------|--------|------------|-----------|
| 5 | 6a. Increase Big 3 card contrast | pending | | |
| 6 | 6b. Shot-by-shot trend lines component | pending | | |
| 7 | 6c. Global date range filter | pending | | |
| 8 | 6d. Session notes field | pending | | |

### Phase 7: Advanced Features

| # | Task | Status | SHA Before | SHA After |
|---|------|--------|------------|-----------|
| 9  | 7a. 2D trajectory visualization | pending | | |
| 10 | 7b. Shot-by-shot navigation | pending | | |
| 11 | 7c. Goal tracking system | pending | | |

## Task Details

### Task 1: 5a. Filter club dropdown to bag clubs only
**File:** `pages/2_ðŸŒï¸_Club_Profiles.py`
**Done when:** Club dropdown shows only clubs from `my_bag.json` (11 entries), ordered by bag order. Shots with club="Unknown" excluded. Uses `is_in_bag()` from `utils/bag_config.py`.
**Current:** Line 42 does `all_shots['club'].dropna().unique()` â€” shows ALL club values.
**Change:** Filter to `[c for c in clubs if is_in_bag(c)]` after getting unique values.

### Task 2: 5b. Smart comparison suggestions
**File:** `pages/2_ðŸŒï¸_Club_Profiles.py`
**Done when:** The "Compare with Other Clubs" multiselect (line 109) defaults to bag neighbors. Viewing 7 Iron â†’ default 6 Iron + 8 Iron. Viewing Driver â†’ 3 Wood. Uses `get_bag_order()`.
**Current:** Defaults to `other_clubs[:2]` (first 2 in list).
**Change:** Add `get_smart_defaults(selected, bag_order)` helper. Import `get_bag_order` and `is_in_bag`.

### Task 3: 5c. Fix Distance Over Time x-axis labels
**File:** `components/club_trends.py`
**Done when:** X-axis shows "Jan 15", "Feb 3" format instead of full ISO timestamps. All 4 charts in component updated.
**Current:** Line 23 converts to datetime, Plotly auto-formats as full timestamp.
**Change:** Add `tickformat='%b %d'` to xaxis dict in all `fig.update_layout()` calls.

### Task 4: 5-tests. Unit tests for Phase 5
**File:** `tests/unit/test_club_profiles.py` (new)
**Done when:** Tests cover bag filtering, smart comparison defaults (neighbors, edges), date format fix.

### Task 5: 6a. Big 3 card contrast
**File:** `components/big3_summary.py`
**Done when:** Cards are clearly readable. Labels brighter (#ddd+), values white, tendency text bolder.
**Current:** `background:#1a1a2e`, labels `color:#aaa`, sublabels `color:#888`.
**Change:** Labels â†’ `#ccc`, values â†’ `#fff`, sublabels â†’ `#999`.

### Task 6: 6b. Shot-by-shot trend lines
**File:** `components/shot_trends.py` (new)
**Done when:** `render_shot_trends(df, title)` shows face_angle + club_path across shot numbers 1-N. Two-line plotly chart. Summary line below indicating warmup/fatigue pattern.
**Pattern:** Stateless component, plotly_dark template, matches existing component style.

### Task 7: 6c. Global date range filter
**Files:** `utils/date_filter.py` (new), `app.py`, `pages/1_ðŸ“Š_Dashboard.py`, `pages/2_ðŸŒï¸_Club_Profiles.py`
**Done when:** Date range selector with presets (This Week, Last Month, Last 3 Months, All Time, Custom). Stored in `st.session_state`. All main pages apply the filter.
**Approach:** Utility function `apply_date_filter(df)` reads session_state and filters. Selector widget rendered in sidebar or top of page.

### Task 8: 6d. Session notes
**Files:** `golf_db.py`, `app.py`
**Done when:** `notes` in `ALLOWED_UPDATE_FIELDS` frozenset. `notes` column added to shots schema. Text input in Practice Journal session detail.
**Change:** Add `'notes'` to frozenset at golf_db.py:1067. Add column in `init_db()`. Add text_area in session detail.

### Task 9: 7a. Trajectory visualization
**File:** `components/trajectory_view.py` (new)
**Done when:** `render_trajectory(df)` draws 2D side-view arcs using launch_angle, apex, carry, descent_angle. Multiple shots overlaid with transparency.
**Data:** Shots table has these columns. Use parametric arc: rise at launch_angle to apex at ~60% of carry, descend at descent_angle.

### Task 10: 7b. Shot-by-shot navigation
**File:** `components/shot_navigator.py` (new)
**Done when:** Previous/Next buttons step through shots in a session. Full metric display per shot + mini trajectory. Uses `st.session_state` for index.

### Task 11: 7c. Goal tracking
**Files:** `utils/goal_tracker.py` (new), `my_goals.json` (new), `pages/2_ðŸŒï¸_Club_Profiles.py`
**Done when:** Users can set per-club goals (carry target). Progress bar on Club Profiles. Goals persisted in JSON.

## Codex Commands

```bash
# Template for each task:
BEFORE=$(git rev-parse HEAD)

/Users/max1/.npm-global/bin/codex --profile power exec \
  --full-auto \
  -C /Users/max1/Documents/GitHub/GolfDataApp \
  --output-last-message /tmp/codex-result.json \
  "{task_description}"

EXIT=$?
RESULT=$(cat /tmp/codex-result.json 2>/dev/null)
COMMITS=$(git log --oneline $BEFORE..HEAD)
```

## Recovery History

(none yet)
