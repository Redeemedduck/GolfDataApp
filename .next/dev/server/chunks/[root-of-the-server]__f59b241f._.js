module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/child_process [external] (child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/process [external] (process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/querystring [external] (querystring, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/assert [external] (assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}),
"[externals]/tty [external] (tty, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}),
"[project]/src/lib/bigquery.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "executeCustomQuery",
    ()=>executeCustomQuery,
    "getClubPerformance",
    ()=>getClubPerformance,
    "getOverallStats",
    ()=>getOverallStats,
    "getRecentShots",
    ()=>getRecentShots
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2d$cloud$2f$bigquery$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@google-cloud/bigquery/build/src/index.js [app-route] (ecmascript)");
;
const projectId = process.env.GCP_PROJECT_ID || 'valued-odyssey-474423-g1';
const dataset = process.env.BQ_DATASET_ID || 'golf_data';
const table = process.env.BQ_TABLE_ID || 'shots';
let bigqueryClient = null;
function getBigQueryClient() {
    if (!bigqueryClient) {
        bigqueryClient = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2d$cloud$2f$bigquery$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BigQuery"]({
            projectId
        });
    }
    return bigqueryClient;
}
async function getOverallStats(days = 30) {
    const client = getBigQueryClient();
    const query = `
    SELECT
      COUNT(*) as total_shots,
      ROUND(AVG(carry), 1) as avg_carry,
      ROUND(AVG(smash), 2) as avg_smash,
      ROUND(AVG(ball_speed), 1) as avg_ball_speed,
      STRING_AGG(DISTINCT club ORDER BY club) as clubs,
      COUNT(DISTINCT session_id) as sessions
    FROM \`${projectId}.${dataset}.${table}\`
    WHERE DATE(date_added) >= DATE_SUB(CURRENT_DATE(), INTERVAL ${days} DAY)
      AND carry > 0
  `;
    const [rows] = await client.query({
        query
    });
    if (rows.length === 0 || rows[0].total_shots === 0) {
        return {
            totalShots: 0,
            avgCarry: 0,
            avgSmash: 0,
            avgBallSpeed: 0,
            clubs: [],
            recentSessions: 0
        };
    }
    const row = rows[0];
    return {
        totalShots: parseInt(row.total_shots),
        avgCarry: parseFloat(row.avg_carry),
        avgSmash: parseFloat(row.avg_smash),
        avgBallSpeed: parseFloat(row.avg_ball_speed),
        clubs: row.clubs ? row.clubs.split(',') : [],
        recentSessions: parseInt(row.sessions)
    };
}
async function getClubPerformance(days = 30) {
    const client = getBigQueryClient();
    const query = `
    SELECT
      club,
      COUNT(*) as shots,
      ROUND(AVG(carry), 1) as avg_carry,
      ROUND(AVG(smash), 2) as avg_smash,
      ROUND(AVG(ball_speed), 1) as avg_ball_speed,
      ROUND(STDDEV(carry), 1) as consistency
    FROM \`${projectId}.${dataset}.${table}\`
    WHERE DATE(date_added) >= DATE_SUB(CURRENT_DATE(), INTERVAL ${days} DAY)
      AND carry > 0
    GROUP BY club
    ORDER BY avg_carry DESC
  `;
    const [rows] = await client.query({
        query
    });
    return rows.map((row)=>({
            club: row.club,
            shots: parseInt(row.shots),
            avgCarry: parseFloat(row.avg_carry),
            avgSmash: parseFloat(row.avg_smash),
            avgBallSpeed: parseFloat(row.avg_ball_speed),
            consistency: parseFloat(row.consistency || 0)
        }));
}
async function getRecentShots(club, limit = 10) {
    const client = getBigQueryClient();
    const clubFilter = club ? `AND club = '${club}'` : '';
    const query = `
    SELECT
      shot_id,
      session_id,
      club,
      carry,
      total,
      smash,
      ball_speed,
      club_speed,
      launch_angle,
      side_spin,
      back_spin,
      DATE(date_added) as shot_date
    FROM \`${projectId}.${dataset}.${table}\`
    WHERE carry > 0
      ${clubFilter}
    ORDER BY date_added DESC
    LIMIT ${limit}
  `;
    const [rows] = await client.query({
        query
    });
    return rows;
}
async function executeCustomQuery(userQuery) {
    const client = getBigQueryClient();
    // For safety, we'll provide a sanitized interface
    // In production, you'd want more sophisticated query validation
    const [rows] = await client.query({
        query: userQuery
    });
    return rows;
}
}),
"[project]/src/lib/gemini.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "generateGolfInsights",
    ()=>generateGolfInsights
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$generative$2d$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@google/generative-ai/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$bigquery$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/bigquery.ts [app-route] (ecmascript)");
;
;
const apiKey = process.env.GEMINI_API_KEY;
let genAI = null;
function getGeminiClient() {
    if (!genAI && apiKey) {
        genAI = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$generative$2d$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["GoogleGenerativeAI"](apiKey);
    }
    return genAI;
}
async function generateGolfInsights(userMessage, context) {
    const client = getGeminiClient();
    if (!client) {
        throw new Error('Gemini API key not configured');
    }
    // Fetch recent golf data from BigQuery
    const [stats, clubPerf] = await Promise.all([
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$bigquery$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOverallStats"])(30),
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$bigquery$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getClubPerformance"])(30)
    ]);
    // Build context about the golfer's data
    const dataContext = `
You are an expert golf coach analyzing shot data from a TrackMan/Uneekor launch monitor.
This golfer practices at Denver altitude (5,280 ft).

CURRENT PERFORMANCE DATA (Last 30 Days):
- Total Shots: ${stats.totalShots}
- Practice Sessions: ${stats.recentSessions}
- Clubs Used: ${stats.clubs.join(', ')}
- Average Carry: ${stats.avgCarry.toFixed(1)} yards
- Average Smash Factor: ${stats.avgSmash.toFixed(2)}
- Average Ball Speed: ${stats.avgBallSpeed.toFixed(1)} mph

CLUB-BY-CLUB PERFORMANCE:
${clubPerf.map((c)=>`
- ${c.club}:
  * ${c.shots} shots
  * Avg Carry: ${c.avgCarry.toFixed(1)} yards
  * Smash Factor: ${c.avgSmash.toFixed(2)}
  * Ball Speed: ${c.avgBallSpeed.toFixed(1)} mph
  * Consistency (Std Dev): ${c.consistency.toFixed(1)} yards
`).join('')}

INSTRUCTIONS:
- Provide specific, actionable insights based on the data above
- Reference actual numbers from their performance
- Compare to PGA Tour averages when relevant (adjusted for Denver altitude)
- Be encouraging but honest about areas needing improvement
- For questions about specific clubs, focus your analysis on that club's data
- If asked about trends, note that you're analyzing the last 30 days
- Keep responses concise and focused (2-3 paragraphs max)
`;
    const model = client.getGenerativeModel({
        model: 'gemini-1.5-flash',
        systemInstruction: dataContext
    });
    // Build conversation history
    const history = context?.conversationHistory || [];
    const chat = model.startChat({
        history: history.map((msg)=>({
                role: msg.role,
                parts: [
                    {
                        text: msg.parts
                    }
                ]
            }))
    });
    const result = await chat.sendMessage(userMessage);
    const response = result.response;
    return response.text();
}
}),
"[project]/src/app/api/chat/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "POST",
    ()=>POST,
    "dynamic",
    ()=>dynamic,
    "maxDuration",
    ()=>maxDuration,
    "runtime",
    ()=>runtime
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$gemini$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/gemini.ts [app-route] (ecmascript)");
;
;
const runtime = 'nodejs';
const dynamic = 'force-dynamic';
const maxDuration = 60; // Allow up to 60 seconds for AI response
// In-memory conversation storage (in production, use Redis or database)
const conversations = new Map();
async function POST(request) {
    try {
        const { message, sessionId, conversationHistory } = await request.json();
        if (!message) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Message is required'
            }, {
                status: 400
            });
        }
        // Get or create conversation context
        const currentSessionId = sessionId || `session-${Date.now()}`;
        let context = conversations.get(currentSessionId);
        if (!context && conversationHistory) {
            context = {
                conversationHistory
            };
            conversations.set(currentSessionId, context);
        }
        // Generate AI response with BigQuery data
        const aiResponse = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$gemini$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateGolfInsights"])(message, context);
        // Update conversation history
        if (context) {
            context.conversationHistory.push({
                role: 'user',
                parts: message
            }, {
                role: 'model',
                parts: aiResponse
            });
        } else {
            conversations.set(currentSessionId, {
                conversationHistory: [
                    {
                        role: 'user',
                        parts: message
                    },
                    {
                        role: 'model',
                        parts: aiResponse
                    }
                ]
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            response: aiResponse,
            sessionId: currentSessionId,
            timestamp: new Date().toISOString()
        });
    } catch (error) {
        console.error('Chat API error:', error);
        // Provide user-friendly error messages
        const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';
        if (errorMessage.includes('API key')) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'AI service not configured. Please set GEMINI_API_KEY environment variable.'
            }, {
                status: 503
            });
        }
        if (errorMessage.includes('BigQuery')) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Database connection error. Please check BigQuery configuration.'
            }, {
                status: 503
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: `Failed to process chat message: ${errorMessage}`
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__f59b241f._.js.map